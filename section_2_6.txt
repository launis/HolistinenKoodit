2.6 Tekninen Toteutuskehys ja Monikerroksinen Puolustusstrategia
Järjestelmän eheyden varmistaa monikerroksinen puolustusstrategia, joka torjuu kielimalleihin liittyviä uhkia (OWASP Foundation 2025f). Strategia perustuu monikerroksisen puolustuksen (engl. Defense in Depth, DiD) -malliin (CISA 2016) ja koostuu kolmesta toisiaan täydentävästä kontrollikerroksesta
Simuloitu Tekninen Kontrollikerros (Luku 2.6.1) suojaa ensisijaisesti ulkoisilta uhilta, kuten kehotemurroilta (LLM01:2025). Prototyypissä tämä kerros on toteutettu behavioraalisena simulaationa (kehotepohjainen sanitointi), joka emuloi tuotantoympäristön teknisiä kontrolleja, mutta ei korvaa niitä (vrt. Jia ym. 2025).
Behavioraalinen Kontrollikerros (Luku 2.6.2) hallitsee agenttien sisäistä toimintaa ja torjuu toimivallan ylittämistä (LLM06:2025).
Hallinnollinen Kontrollikerros (Luku 2.6.3) toimii ylimpänä valvontamekanismina.
Prototyypin nykytilassa järjestelmän turvallisuutta ja luotettavuutta rajoittaa useiden kehittyneiden teknisten toimintojen puuttuminen. Näitä ovat "Semanttinen Anonymisointi" (jota kompensoidaan kehotepohjaisella analyysilla), "Upotusten Eheyden Tarkistus" ja "Uudelleensijoitusmalli". Turvallisuusmalli koostuu kolmesta tasosta, jotka esitellään seuraavissa alaluvuissa.
2.6.1 Tekninen Kontrollikerros
Ensimmäinen puolustuslinja suojaa ulkoisilta teknisiltä uhilta. Vartija-agentti toimii turvaporttina. Sen tehtäviin kuuluu ”Aktiivinen Uhkien Luokittelu”, joka on vastaus epäsuorien kehotemurrosten (engl. Indirect Prompt Injection) uhkaan (LLM01:2025) (Yi ym. 2025; Greshake ym. 2023; Liu, X. ym. 2024). Teknisesti Vartija-agentti-mandaatti sisältää seuraavat toteutetut (mutta testaamattomat) vaiheet:
Rakenteellinen Puhdistus (Input Sanitization) ja Datan Normalisointi: Tämä vaihe yhdistää turvallisuuskontrollit ja datan eheyden varmistamisen. Ensimmäisenä puolustuslinjana (OWASP Foundation s.a) Vartija-agentin tehtävä on muuntaa kaikki syötteet (esim. PDF, DOCX) raakatekstiksi. Tämä pienentää hyökkäyspinta-alaa poistamalla monimutkaisten tiedostomuotojen käsittelyyn liittyviä riskejä ja varmistaa datan yhdenmukaisuuden (OWASP Foundation 2025d). Tähän prosessiin kuuluu pakollinen datan normalisointi, joka on kriittistä merkistön eheyden ja interoperabiliteetin varmistamiseksi, erityisesti manuaalisessa orkestroinnissa (vrt. Luku 5.2.4; W3C 2008). Normalisointi sisältää pakollisen UTF-8-merkistökoodauksen varmistamisen sekä typografisten merkkien (kuten "älykkäiden lainausmerkkien") muuntamisen standardeiksi ASCII-merkeiksi datan yhdenmukaisuuden takaamiseksi. Tämän jälkeen se poistaa aktiivisesti kaikki tunnetut haitalliset merkit, skriptit ja ohjausmerkit (control characters).
Datan Anonymisointi (OWASP LLM02:2025-torjunta): Tämä vaihe torjuu arkaluontoisen tiedon paljastumista. Vartija-agentin tehtävä on hakea ja peittää tunnistettavat henkilötiedot (PII) monikerroksisesti (vrt. Lison ym. 2021; Li ym. 2024). Prototyyppivaiheessa ulkoisilla kirjastoilla toteutettu deterministinen anonymisointi puuttuu. Tämä korvataan agenttipohjaisella hybridimallilla, joka yhdistää sääntöpohjaiset (RegEx) menetelmät kielimallin suorittamaan "Kontekstuaaliseen PII-Analyysiin". Tämä mahdollistaa epätyypillisten, kontekstisidonnaisten henkilötietojen tunnistamisen, mihin perinteiset säännöt eivät taivu (vrt. Li ym. 2024), vaikka menetelmä sisältääkin stokastisen epävarmuuden.
Aktiivinen Uhkien Luokittelu (OWASP LLM01:2025-torjunta): Tämä vaihe on suora vastaus epäsuorien kehotemurrosten (Indirect Prompt Injection) uhkaan. Viitekehyksen visiona on käyttää erillistä teknistä luokittelijaa.
Nykyinen prototyyppitoteutus toteuttaa tämän kontrollin prototyyppivaiheessa kehotepohjaisena 'semanttisena perustuslakitarkistuksena' (vrt. Bai ym. 2022). Tämä luo kuitenkin puolustuksellisen paradoksin: järjestelmä pyrkii torjumaan kehotemurtoja (LLM01) instrumentilla (kehote), joka on altis samalle hyökkäykselle. Ilman ulkoista luokittelijaa tämä kontrolli on katsottava 'syvyyspuolustukseksi' (Defense in Depth) eikä täydelliseksi ratkaisuksi. Menetelmä on altis kehittyneille prompt injection -hyökkäyksille, kuten Jia et al. (2025) ovat osoittaneet. Jia ym. (2025) kritisoivat nykyisiä puolustusmekanismeja siitä, että ne eivät ole riittävän tehokkaita adaptiivisia hyökkäyksiä vastaan. 
Prototyypin turvallisuus perustuu osittain "Adversariaaliseen Simulaatioon", jossa Vartija pakotetaan suorittamaan monivaiheinen uhka-analyysi sisäisessä päättelytilassa (scratchpad), omaksumalla ensin "Punaisen Tiimin" (Hyökkääjä) rooli ja simuloimalla hyökkäystä, ja sen jälkeen "Sinisen Tiimin" (Puolustaja) rooli arvioimalla sen onnistumista. Tämä syventää analyysia kohti syötteen intention ymmärtämistä (vrt. Perez ym. 2022a). On kuitenkin tärkeää huomata, että tämä luo perustavanlaatuisen arkkitehtonisen ristiriidan: järjestelmä pyrkii torjumaan kehotemurtoja (LLM01) käyttämällä menetelmää (kehotepohjainen kontrolli), joka itsessään on kaikkein haavoittuvin juuri kyseiselle hyökkäykselle. Kuten Luvussa 2.5.1 todetaan, tämä on tunnistettu merkittävä tekninen rajoite ja haurauden lähde (vrt. Jia ym. 2025; Liu, Y. ym. 2023).
Vartija-agentin operatiivinen toteutus sisältää yksityiskohtaiset tehtävät näiden teknisen kerroksen toimintojen suorittamiseksi (Rakenteellinen Puhdistus, Anonymisointi ja Uhkien Luokittelu).
Upotusten Eheyden Tarkistus (OWASP LLM08:2025-Torjunta): Viitekehyksen visioon kuuluu Vartija-agentin kyky tunnistaa RAG-arkkitehtuuriin kohdistuvia hyökkäyksiä suorittamalla ajonaikainen poikkeamien havaitseminen upotustilassa (vrt. Zilliz 2024; OWASP Foundation 2025e). On kuitenkin kriittistä huomata, että nykyisessä prototyypissä tämä kontrolli on toteutettu ainoastaan "negatiivisena lokikirjauksena". Järjestelmä pakottaa Vartija-agentin kirjaamaan puuttuvan suojauksen eksplisiittiseksi riskiksi ('LLM08-riski hallitsematon'), mikä tekee haavoittuvuudesta läpinäkyvän (XAI) mutta ei poista sitä teknisesti. Tämä 'Negative Logging' -menetelmä varmistaa, että haavoittuvuus raportoidaan aina loppukäyttäjälle (XAI-Raportti), vaikka sitä ei voida prototyypissä torjua (OWASP Foundation 2025e).
Datan Merkintä (engl. Input Tainting): Viimeisenä valmisteluvaiheena ja ainoastaan jos aiempien vaiheiden turvatarkistukset on läpäisty, Vartija-agentin tehtävä on koota kaikki puhdistettu data yhteen objektiin. Tämä menetelmä (Input Tainting) luo eristetyn ”luottamuksen kehän” (engl. Chain of Trust): vain tämän objektin sisällä oleva data on validoitua. Tämä on kriittinen kontrolli, sillä järjestelmän behavioraaliset säännöt (ks. Sääntö 3; Luku 2.6.2) pakottavat kaikki myöhemmät agentit käsittelemään ainoastaan tätä tarkistettua dataa ja hylkäämään data, joka ei ole peräisin tästä lähteestä (vrt. Secure Information Flow; Denning & Denning 1977).
2.6.2 Behavioraalinen Kontrollikerros
Järjestelmän toinen puolustuslinja rakentuu behavioraalisen kontrollikerroksen varaan, joka toimii niin kutsuttuna kognitiivisena palomuurina. Tämän kerroksen ensisijaisena tehtävänä on hallita tekoälymallien toimintaa ja estää agenttien toimivallan ylittyminen (engl. excessive agency) (OWASP Foundation 2025d).
Tämän tavoitteen saavuttamiseksi järjestelmä asettaa tiukat rajoitteet, jotka kieltävät eksplisiittisesti agentteja hyödyntämästä määrittelemättömiä ulkoisia työkaluja tai API-rajapintoja. Rajoituksilla pyritään torjumaan työkalujen käyttöön liittyviä haavoittuvuuksia (engl. tool-use vulnerability) (Research AIMultiple 2025). Lisäksi kontrollikerroksella ehkäistään systeemisiä riskejä, kuten roolivuotoa (engl. role-bleed), jossa agentti saattaa sekoittaa eri tehtäväkonteksteja tai ylittää sille määritellyn kognitiivisen roolin rajat (Yeager.ai 2023). Tämä rajaus on kriittinen tekijä kognitiiviseen työnjakoon perustuvan arkkitehtuurin eheyden säilyttämiseksi.
Järjestelmän eheyden ja yhteentoimivuuden varmistamiseksi järjestelmän sääntöihin on koodattu pakollinen, standardoitu kolmivaiheinen validointiprotokolla, jonka jokaisen agentin on suoritettava ennen tehtävänsä aloittamista:
Rakenteellinen eheys ja puhdistus: Syötteen JSON-muodon validointi ja tarvittaessa virheensietoinen jäsennys (engl. robust parsing) eli "aggressiivinen puhdistus". Tämä mekanismi pyrkii pelastamaan JSON-objektin poistamalla systemaattisesti tunnettuja formaattivääristymiä, kuten Markdown-koodilohkojen jäänteitä tai ylimääräisiä johdantotekstejä, jotka ovat tyypillisiä manuaalisessa orkestroinnissa. 
Semanttinen eheys (Tarkistussumma): Datan sisällön vertaaminen edellisen vaiheen generoimaan semanttiseen tarkistussummaan datakorruption tai siirtovirheiden havaitsemiseksi (ks. Luku 5.2.4).
Rakenteellinen skeptisyys: Syötteen rakenteen kriittinen tarkastelu anomaliatunnisteiden, kuten epätyypillisen pituuden tai piilokomentoja muistuttavan kielen, havaitsemiseksi, mikä toimii sekundaarisena suojana kehotemurtoja (LLM01) vastaan.
Puolustusstrategia noudattaa syvyyspuolustuksen (engl. defense-in-depth) periaatetta hyödyntämällä redundanssia kahdella mekanismilla. Ensinnäkin kaikkia jälkiagentteja velvoitetaan ylläpitämään rakenteellista skeptisyyttä vastaanottamaansa dataa kohtaan, mikä luo ylimääräisen suojakerroksen Vartija-agentin mahdollisten virheiden varalle. Toiseksi järjestelmässä sovelletaan ristiinvalidoivaa päättelyketjua (engl. Cross-Validating Chain-of-Thought). Tässä menetelmässä agentit pakotetaan validoimaan edeltävän agentin päättelyn looginen johdonmukaisuus ja ankkurointi todistusaineistoon ennen oman prosessinsa käynnistämistä. Tämä toimii sekventiaalisen prosessin sisäisenä auditointina, joka vähentää virheiden kumuloitumisen riskiä prosessissa ja vahvistaa järjestelmän resilienssiä yksittäisten agenttien virheitä vastaan (vrt. Luku 5.2.2).
On kuitenkin huomattava, että pelkkä kehotepohjainen ohjaus on luonteeltaan hauras (vrt. Greshake ym. 2023). Koska kehotteet eivät voi teknisesti täysin estää agenttia käsittelemästä samassa konteksti-ikkunassa olevaa muuta dataa, behavioraalista kerrosta on täydennettävä pakollisilla teknisillä kontrolleilla. Näihin lukeutuvat agenttien suorittaminen eristetyissä ympäristöissä (engl. sandbox) sekä tiukka pääsynhallinta (Towards AI 2025). Nämä kontrollit ovat keskeisiä LLM-agenttien turvallisuuden varmistamisessa (OWASP Foundation 2025d), noudattaen vähimpien oikeuksien periaatetta (Saltzer & Schroeder 1975). Nykyisessä prototyypissä, jossa orkestrointi on manuaalista, vastuu eristämisestä on siirretty ihmisvalvojalle. Ilman ulkoisia, deterministisiä eristysympäristöjä ja verkkotason eriyttämistä, järjestelmän behavioraalinen suojaus on katsottava luonteeltaan ensisijaisesti performatiiviseksi turvakerrokseksi.
2.6.3 Hallinnollinen Kontrollikerros
Viimeinen kontrollitaso auditoi ja valvoo prosessia (Ihmisvalvonta, HITL). Se toimii ylimpänä suojana monimutkaisia uhkia vastaan. Arkkitehtuurin on hallittava myös muita riskejä. Turvaton tuotoksen käsittely (LLM05:2025) torjutaan tulosteen koodauksella (OWASP Foundation 2025c). Toimitusketjun haavoittuvuuksia (LLM03:2025) hallitaan LLMOps-käytännöillä (Kreuzberger ym. 2023). Opetusdatan myrkyttäminen (LLM04:2025) puolestaan estetään käyttämällä vain ihmisen validoimaa dataa (D'Angelo 2025).
Luku 3: Viitekehyksen Asemointi: Vertaileva Analyysi Akateemisiin ja Kaupallisiin Ratkaisuihin
Tämä luku sijoittaa viitekehyksen laajempaan kontekstiin vertaamalla sitä akateemiseen tutkimukseen ja kaupallisiin sovelluksiin. Tavoitteena on tunnistaa viitekehyksen keskeinen innovaatio ja strateginen erottautumistekijä.